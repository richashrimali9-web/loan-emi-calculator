<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title id="pageTitle">Unified Loan EMI Calculator</title>
  <meta name="description" id="pageDesc" content="Calculate EMI for Home, Personal, and Car Loans. Compare offers, view amortization schedule, and more.">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Segoe+UI:400,500,700&display=swap" as="style">
  <style>
    :root {
      --home: #2d6cdf;
      --personal: #27ae60;
      --car: #e67e22;
      --accent: #f5f7fa;
      --border: #e0e4ea;
      --danger: #e74c3c;
      --radius: 10px;
      --card-shadow: 0 2px 12px rgba(44,62,80,0.07);
      --cta: #fff;
      --cta-hover: #f0f0f0;
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--accent);
      margin: 0;
      padding: 0;
      color: #222;
    }
    .container {
      max-width: 430px;
      margin: 2rem auto;
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--card-shadow);
      padding: 2rem 1.5rem 1.5rem 1.5rem;
    }
    h1 {
      text-align: center;
      color: var(--home);
      margin-bottom: 1.2rem;
      font-size: 1.6rem;
      letter-spacing: 0.02em;
    }
    .tabs {
      display: flex;
      overflow-x: auto;
      margin-bottom: 1.2rem;
      border-radius: var(--radius);
      background: var(--accent);
      box-shadow: 0 1px 4px rgba(44,62,80,0.04);
      -webkit-overflow-scrolling: touch;
      border-bottom: 2px solid #e0e4ea;
    }
    .tab {
      flex: 1 1 0;
      min-width: 44px;
      text-align: center;
      padding: 0.8em 0.2em;
      font-size: 1.08rem;
      cursor: pointer;
      border: none;
      background: transparent;
      color: #222;
      outline: none;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      border-bottom: 4px solid transparent;
      font-weight: 500;
      user-select: none;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5em;
    }
    .tab.active {
      box-shadow: 0 4px 12px rgba(44,62,80,0.10);
    }
    .tab.home.active {
      color: var(--home);
      border-bottom: 4px solid var(--home);
      background: #eaf2ff;
    }
    .tab.personal.active {
      color: var(--personal);
      border-bottom: 4px solid var(--personal);
      background: #eafaf3;
    }
    .tab.car.active {
      color: var(--car);
      border-bottom: 4px solid var(--car);
      background: #fff5e9;
    }
    .tab:hover {
      background: #f6faff;
    }
    .tab.home:hover { background: #f0f6ff; }
    .tab.personal:hover { background: #f0fff6; }
    .tab.car:hover { background: #fff8f0; }
    .tab:focus {
      background: #f0f0f0;
    }
    .tab .tab-icon {
      font-size: 1.3em;
      vertical-align: middle;
      margin-right: 0.2em;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1.1rem;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.2em;
      margin-bottom: 0.2em;
    }
    label {
      font-size: 0.98rem;
      margin-bottom: 0.2em;
      color: #444;
    }
    input[type="number"] {
      width: 100%;
      padding: 0.7em;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      font-size: 1rem;
      background: #f8fafc;
      box-sizing: border-box;
      transition: border 0.2s;
    }
    input[type="number"]:focus {
      border-color: var(--home);
    }
    .helper {
      font-size: 0.9rem;
      color: #666;
      margin-top: 6px;
      margin-bottom: 6px;
      display: block;
    }
    .helper.mobile-tooltip {
      display: none;
      position: relative;
    }
    .helper-icon {
      display: none;
      font-size: 1.1em;
      color: #666;
      margin-left: 6px;
      cursor: pointer;
      vertical-align: middle;
    }
    @media (max-width: 480px) {
      .helper { display: none; }
      .helper-icon { display: inline-block; }
      .helper.mobile-tooltip { display: block; position: absolute; background: #fff; color: #222; border: 1px solid #e0e4ea; border-radius: 6px; padding: 6px 10px; font-size: 0.9rem; z-index: 10; left: 30px; top: 0; min-width: 120px; box-shadow: 0 2px 8px rgba(44,62,80,0.08); }
    }
    .error {
      color: var(--danger);
      font-size: 0.97rem;
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      text-align: center;
    }
    .results-card {
      margin-top: 1.2rem;
      border-radius: var(--radius);
      box-shadow: var(--card-shadow);
      padding: 20px;
      color: #1a202c;
      background: #eef4ff;
      transition: background 0.2s, color 0.2s;
      position: relative;
    }
    .results-card.personal { background: #eafaf3; color: #1a202c; }
    .results-card.car { background: #fff5e9; color: #1a202c; }
    .results-card h2 {
      font-size: 1.1rem;
      margin-bottom: 0.7em;
      margin-top: 0;
      color: #1a202c;
    }
    .results-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .results-list li {
      margin-bottom: 8px;
      font-size: 1rem;
    }
    .cta-row {
      display: flex;
      flex-direction: row;
      gap: 0.7em;
      margin-top: 1.1em;
    }
    .cta-btn {
      min-height: 44px;
      font-size: 1.08rem;
      font-weight: 500;
      border-radius: var(--radius);
      outline: none;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, border 0.2s;
      width: 100%;
      box-sizing: border-box;
      padding: 0.8em;
      margin: 0;
    }
    .cta-btn.primary {
      background: var(--home);
      color: #fff;
      border: none;
      box-shadow: 0 1px 4px rgba(44,62,80,0.04);
    }
    .cta-btn.primary:hover, .cta-btn.primary:focus {
      background: #1b4fa0;
      color: #fff;
    }
    .cta-btn.secondary {
      background: #eef4ff;
      color: var(--home);
      border: 2px solid var(--home);
    }
    .cta-btn.secondary:hover, .cta-btn.secondary:focus {
      background: #eaf2ff;
      color: #1a202c;
      border-color: #1b4fa0;
    }
    @media (max-width: 600px) {
      .cta-row {
        flex-direction: column;
        gap: 0.7em;
      }
      .cta-btn {
        width: 100%;
      }
    }
    .collapse-section {
      margin-top: 1.2em;
      border-radius: var(--radius);
      background: var(--accent);
      box-shadow: 0 1px 4px rgba(44,62,80,0.04);
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(.4,0,.2,1);
      max-height: 56px;
      position: relative;
    }
    .collapse-header {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.7em;
      cursor: pointer;
      padding: 1em;
      font-size: 1.08rem;
      color: var(--home);
      background: #f8fafc;
      border-bottom: 1px solid var(--border);
      min-height: 44px;
      user-select: none;
      transition: color 0.2s;
    }
    .collapse-header.personal { color: var(--personal);}
    .collapse-header.car { color: var(--car);}
    .chevron {
      width: 24px;
      height: 24px;
      display: inline-block;
      vertical-align: middle;
      transition: transform 0.4s cubic-bezier(.4,0,.2,1);
      fill: currentColor;
    }
    .collapse-section.expanded .chevron {
      transform: rotate(180deg);
    }
    .collapse-section:not(.expanded) .chevron {
      transform: rotate(0deg);
    }
    .collapse-section.expanded {
      max-height: 1200px;
      transition: max-height 0.6s cubic-bezier(.4,0,.2,1);
    }
    .collapse-section:not(.expanded) .collapse-content {
      display: none;
    }
    .collapse-section.expanded .collapse-content {
      display: block;
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0;}
      to { opacity: 1;}
    }
    .amort-summary {
      margin: 16px 0;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    .amort-summary-heading {
      font-size: 1rem;
      color: #444;
      font-weight: 500;
      margin: 0;
    }
    .amort-badge {
      display: inline-flex;
      align-items: center;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.92rem;
      font-weight: 500;
      color: #fff;
      white-space: nowrap;
    }
    .amort-badge.principal {
      background: #3366cc;
    }
    .amort-badge.interest {
      background: #e67c32;
    }
    .amort-badge-amount {
      font-weight: 600;
      margin-right: 6px;
    }
    .amort-badge-percent {
      font-size: 0.88rem;
      opacity: 0.95;
    }
    @media (max-width: 600px) {
      .amort-summary {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      .amort-badge {
        font-size: 0.88rem;
        padding: 6px 12px;
      }
    }
    .amort-table-wrapper {
      overflow-x: auto;
      overflow-y: auto;
      max-height: 480px;
      margin: 16px 0 1rem 0;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--card-shadow);
      background: #fff;
      -webkit-overflow-scrolling: touch;
      position: relative;
    }
    .amort-table {
      width: 100%;
      min-width: 700px;
      border-collapse: collapse;
      font-size: 0.95rem;
      background: #fff;
      display: table;
    }
    .amort-table th {
      background: #f5f7fa;
      color: #2d6cdf;
      font-weight: 600;
      font-size: 0.95rem;
      text-align: right;
      padding: 12px 8px;
      border: 1px solid var(--border);
      white-space: nowrap;
      border-bottom: 2px solid #2d6cdf;
    }
    .amort-table td {
      padding: 10px 8px;
      border: 1px solid var(--border);
      text-align: right;
      font-size: 0.93rem;
      color: #333;
    }
    .amort-table tbody tr:hover {
      background: #f8fafc;
    }
    @media (max-width: 600px) {
      .amort-table {
        min-width: 600px;
        font-size: 0.88rem;
      }
      .amort-table th, .amort-table td {
        font-size: 0.85rem;
        padding: 8px 6px;
      }
    }
    @media (max-width: 400px) {
      .tab { font-size: 0.95rem; }
      .results-card { font-size: 0.95rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Unified Loan EMI Calculator</h1>
    <div class="tabs" id="loanTabs" role="tablist">
      <button class="tab home active" data-type="home" id="tabHome" role="tab" aria-selected="true"><span class="tab-icon" style="color:#2d6cdf">🏠</span>Home Loan</button>
      <button class="tab personal" data-type="personal" id="tabPersonal" role="tab" aria-selected="false"><span class="tab-icon" style="color:#27ae60">💳</span>Personal Loan</button>
      <button class="tab car" data-type="car" id="tabCar" role="tab" aria-selected="false"><span class="tab-icon" style="color:#e67e22">🚗</span>Car Loan</button>
    </div>
    <form id="emiForm" autocomplete="off">
      <div class="form-group" style="position:relative;">
        <label for="principal" id="principalLabel">Principal Amount</label>
        <input type="number" id="principal" min="1" required>
        <div class="helper" id="principalHelper"></div>
        <span class="helper-icon" id="principalHelperIcon" tabindex="0" aria-label="Show tip">&#9432;</span>
        <div class="helper mobile-tooltip" id="principalHelperTooltip" style="display:none;"></div>
      </div>
      <div class="form-group" style="position:relative;">
        <label for="rate" id="rateLabel">Annual Interest Rate (%)</label>
        <input type="number" id="rate" min="0.1" step="0.01" required>
        <div class="helper" id="rateHelper"></div>
        <span class="helper-icon" id="rateHelperIcon" tabindex="0" aria-label="Show tip">&#9432;</span>
        <div class="helper mobile-tooltip" id="rateHelperTooltip" style="display:none;"></div>
      </div>
      <div class="form-group" style="position:relative;">
        <label for="tenure" id="tenureLabel">Tenure (Years)</label>
        <input type="number" id="tenure" min="1" required>
        <div class="helper" id="tenureHelper"></div>
        <span class="helper-icon" id="tenureHelperIcon" tabindex="0" aria-label="Show tip">&#9432;</span>
        <div class="helper mobile-tooltip" id="tenureHelperTooltip" style="display:none;"></div>
      </div>
      <div id="errorMsg" class="error" style="display:none;"></div>
    </form>
    <div class="results-card home" id="resultsSection" style="display:none;" aria-live="polite">
      <h2>Results</h2>
      <ul class="results-list" id="resultsList"></ul>
      <div class="cta-row">
        <a href="https://www.google.com/search?q=loan+offers" target="_blank" class="cta-btn primary" id="compareBtn">Compare Loan Offers</a>
        <button class="cta-btn secondary" id="downloadPdfBtn">Download Amortization Schedule (PDF)</button>
      </div>
    </div>
    <div class="collapse-section" id="amortCollapse">
      <div class="collapse-header home" id="collapseHeader">
        <svg class="chevron" id="chevronIcon" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5"/></svg>
        <span>Amortization Schedule</span>
      </div>
      <div class="collapse-content" id="amortSection" style="display:none;">
        <div class="amort-summary">
          <span class="amort-summary-heading">Principal vs Interest:</span>
          <div id="summaryBadges"></div>
        </div>
        <div class="amort-table-wrapper">
          <table class="amort-table" id="amortTable"></table>
        </div>
        <div class="amort-showmore-row">
          <button class="cta-btn secondary" id="showMoreBtn" style="display:none;">Show More</button>
        </div>
      </div>
    </div>
  </div>
  <script defer>
    // Loan type defaults and helpers
    const loanTypes = {
      home: {
        color: 'home',
        principal: 5000000,
        rate: 8.5,
        tenure: 20,
        principalPH: 'Enter loan amount (e.g. ₹50,00,000)',
        ratePH: 'Enter annual interest rate % (e.g. 8.5)',
        tenurePH: 'Enter tenure in years (15–30 yrs)',
        principalTip: 'Typical home loans: ₹10L–₹2Cr',
        rateTip: 'Lower rates for secured loans',
        tenureTip: 'Longer tenor = lower EMI but more interest'
      },
      personal: {
        color: 'personal',
        principal: 500000,
        rate: 12,
        tenure: 3,
        principalPH: 'Enter loan amount (e.g. ₹5,00,000)',
        ratePH: 'Enter annual interest rate % (e.g. 12)',
        tenurePH: 'Enter tenure in years (1–5 yrs)',
        principalTip: 'Personal loans: ₹50k–₹20L',
        rateTip: 'Higher rates for unsecured loans',
        tenureTip: 'Shorter tenor = higher EMI, less interest'
      },
      car: {
        color: 'car',
        principal: 800000,
        rate: 9,
        tenure: 5,
        principalPH: 'Enter loan amount (e.g. ₹8,00,000)',
        ratePH: 'Enter annual interest rate % (e.g. 9)',
        tenurePH: 'Enter tenure in years (1–7 yrs)',
        principalTip: 'Car loans: ₹1L–₹30L',
        rateTip: 'Rates depend on car type & age',
        tenureTip: 'Longer tenor = lower EMI but more interest'
      }
    };

    let activeType = 'home';

    // DOM elements
    const tabHome = document.getElementById('tabHome');
    const tabPersonal = document.getElementById('tabPersonal');
    const tabCar = document.getElementById('tabCar');
    const loanTabs = document.getElementById('loanTabs');
    const principalEl = document.getElementById('principal');
    const rateEl = document.getElementById('rate');
    const tenureEl = document.getElementById('tenure');
    const principalLabel = document.getElementById('principalLabel');
    const rateLabel = document.getElementById('rateLabel');
    const tenureLabel = document.getElementById('tenureLabel');
    const principalHelper = document.getElementById('principalHelper');
    const rateHelper = document.getElementById('rateHelper');
    const tenureHelper = document.getElementById('tenureHelper');
    const errorMsg = document.getElementById('errorMsg');
    const resultsSection = document.getElementById('resultsSection');
    const resultsList = document.getElementById('resultsList');
    const compareBtn = document.getElementById('compareBtn');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');
    const amortCollapse = document.getElementById('amortCollapse');
    const collapseHeader = document.getElementById('collapseHeader');
    const collapseArrow = document.getElementById('collapseArrow');
    const amortSection = document.getElementById('amortSection');
    const amortTable = document.getElementById('amortTable');
    const emiForm = document.getElementById('emiForm');

    // Tab switching logic
    function setActiveTab(type, updateHash=true) {
      activeType = type;
      tabHome.classList.toggle('active', type === 'home');
      tabPersonal.classList.toggle('active', type === 'personal');
      tabCar.classList.toggle('active', type === 'car');
      tabHome.classList.toggle('home', type === 'home');
      tabPersonal.classList.toggle('personal', type === 'personal');
      tabCar.classList.toggle('car', type === 'car');
      tabHome.setAttribute('aria-selected', type === 'home');
      tabPersonal.setAttribute('aria-selected', type === 'personal');
      tabCar.setAttribute('aria-selected', type === 'car');
      resultsSection.className = `results-card ${loanTypes[type].color}`;
      collapseHeader.className = `collapse-header ${loanTypes[type].color}`;
      document.getElementById('chevronIcon').style.color = getComputedStyle(collapseHeader).color;
      updateInputsForLoanType(type);
      if (updateHash) window.location.hash = `#${type}`;
      updateResults();
      updateAmortTable();
      updateMetaTags(type);
    }
    loanTabs.addEventListener('click', e => {
      let btn = e.target.closest('.tab');
      if (btn) setActiveTab(btn.dataset.type);
    });
    window.addEventListener('hashchange', () => {
      const hash = window.location.hash.replace('#','');
      if (loanTypes[hash]) setActiveTab(hash, false);
    });

    // Update meta tags for SEO
    function updateMetaTags(type) {
      const titleMap = {
        home: 'Home Loan EMI Calculator – Unified',
        personal: 'Personal Loan EMI Calculator – Unified',
        car: 'Car Loan EMI Calculator – Unified'
      };
      const descMap = {
        home: 'Calculate EMI for Home Loans. Compare offers, view amortization schedule, and more.',
        personal: 'Calculate EMI for Personal Loans. Compare offers, view amortization schedule, and more.',
        car: 'Calculate EMI for Car Loans. Compare offers, view amortization schedule, and more.'
      };
      document.getElementById('pageTitle').textContent = titleMap[type];
      document.getElementById('pageDesc').setAttribute('content', descMap[type]);
    }

    // Update input placeholders, helpers, and defaults
    function updateInputsForLoanType(type) {
      const t = loanTypes[type];
      principalEl.placeholder = t.principalPH;
      rateEl.placeholder = t.ratePH;
      tenureEl.placeholder = t.tenurePH;
      principalHelper.textContent = t.principalTip;
      rateHelper.textContent = t.rateTip;
      tenureHelper.textContent = t.tenureTip;
      document.getElementById('principalHelperTooltip').textContent = t.principalTip;
      document.getElementById('rateHelperTooltip').textContent = t.rateTip;
      document.getElementById('tenureHelperTooltip').textContent = t.tenureTip;
      principalLabel.textContent = "Principal Amount";
      rateLabel.textContent = "Annual Interest Rate (%)";
      tenureLabel.textContent = "Tenure (Years)";
      principalEl.value = t.principal;
      rateEl.value = t.rate;
      tenureEl.value = t.tenure;
      errorMsg.style.display = 'none';
    }

    // EMI calculation function
    function calculateEMI(principal, annualRate, tenureYears) {
      const n = tenureYears * 12;
      const r = annualRate / 12 / 100;
      if (r === 0) {
        const emi = principal / n;
        return { emi, totalPayment: principal, totalInterest: 0 };
      }
      const emi = principal * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
      const totalPayment = emi * n;
      const totalInterest = totalPayment - principal;
      return { emi, totalPayment, totalInterest };
    }

    // Amortization schedule generator
    function generateAmortizationSchedule(principal, annualRate, tenureYears, emi) {
      const n = tenureYears * 12;
      const r = annualRate / 12 / 100;
      let balance = principal;
      const schedule = [];
      for (let month = 1; month <= n; month++) {
        const interest = balance * r;
        const principalPaid = emi - interest;
        balance -= principalPaid;
        schedule.push({
          month,
          emi,
          principalPaid,
          interestPaid: interest,
          balance: balance > 0 ? balance : 0
        });
      }
      return schedule;
    }

    // Format currency
    function fmt(num) {
      return num.toLocaleString('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function fmt2(num) {
      return num.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    // Real-time results update
    function updateResults() {
      errorMsg.style.display = 'none';
      const principal = Number(principalEl.value);
      const rate = Number(rateEl.value);
      const tenure = Number(tenureEl.value);

      if (!principal || principal < 1) {
        resultsSection.style.display = 'none';
        return;
      }
      if (!rate || rate < 0.1) {
        resultsSection.style.display = 'none';
        return;
      }
      if (!tenure || tenure < 1) {
        resultsSection.style.display = 'none';
        return;
      }
      const result = calculateEMI(principal, rate, tenure);
      resultsList.innerHTML = `
        <li><strong>Monthly EMI:</strong> ${fmt2(result.emi)}</li>
        <li><strong>Total Interest Payable:</strong> ${fmt2(result.totalInterest)}</li>
        <li><strong>Total Payment (Principal + Interest):</strong> ${fmt2(result.totalPayment)}</li>
      `;
      resultsSection.style.display = 'block';
    }

    // Update amortization table
    // Lazy-load amortization table
    let amortRowsToShow = 12;
    let amortScheduleCache = [];
    function updateAmortTable() {
      const principal = Number(principalEl.value);
      const rate = Number(rateEl.value);
      const tenure = Number(tenureEl.value);
      if (!principal || !rate || !tenure) {
        amortTable.innerHTML = '';
        document.getElementById('showMoreBtn').style.display = 'none';
        document.getElementById('summaryBadges').innerHTML = '';
        return;
      }
      const result = calculateEMI(principal, rate, tenure);
      const schedule = generateAmortizationSchedule(principal, rate, tenure, result.emi);
      amortScheduleCache = schedule;
      updateSummaryBadges(principal, result.totalInterest, result.totalPayment);
      let rows = `
        <thead>
          <tr>
            <th>Month</th>
            <th>EMI</th>
            <th>Principal Paid</th>
            <th>Interest Paid</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody>
      `;
      schedule.slice(0, amortRowsToShow).forEach(row => {
        rows += `
          <tr>
            <td>${row.month}</td>
            <td>₹${fmt2(row.emi)}</td>
            <td>₹${fmt2(row.principalPaid)}</td>
            <td>₹${fmt2(row.interestPaid)}</td>
            <td>₹${fmt2(row.balance)}</td>
          </tr>
        `;
      });
      rows += `</tbody>`;
      amortTable.innerHTML = rows;
      // Button logic
      const showMoreBtn = document.getElementById('showMoreBtn');
      if (schedule.length <= 12) {
        showMoreBtn.style.display = 'none';
      } else if (amortRowsToShow < schedule.length) {
        showMoreBtn.style.display = 'block';
        showMoreBtn.textContent = 'Show More';
      } else {
        showMoreBtn.style.display = 'block';
        showMoreBtn.textContent = 'Show Less';
      }
    }
    document.getElementById('showMoreBtn').onclick = function() {
      const schedule = amortScheduleCache;
      if (amortRowsToShow < schedule.length) {
        amortRowsToShow = Math.min(amortRowsToShow + 24, schedule.length);
      } else {
        amortRowsToShow = 12;
      }
      updateAmortTable();
    };

    // Update summary badges for principal vs interest
    function updateSummaryBadges(principal, totalInterest, totalPayment) {
      const pPercent = ((principal / totalPayment) * 100).toFixed(1);
      const iPercent = ((totalInterest / totalPayment) * 100).toFixed(1);
      
      document.getElementById('summaryBadges').innerHTML = `
        <span class="amort-badge principal">
          <span class="amort-badge-amount">₹${fmt2(principal)}</span>
          <span class="amort-badge-percent">(${pPercent}%)</span>
        </span>
        <span class="amort-badge interest">
          <span class="amort-badge-amount">₹${fmt2(totalInterest)}</span>
          <span class="amort-badge-percent">(${iPercent}%)</span>
        </span>
      `;
    }


    // Input event listeners for real-time preview
    [principalEl, rateEl, tenureEl].forEach(el => {
      el.addEventListener('input', () => {
        updateResults();
        updateAmortTable();
      });
    });

    // PDF download (simple implementation using browser print)
    downloadPdfBtn.addEventListener('click', function() {
      // Create a new window with the amortization table for printing
      const principal = Number(principalEl.value);
      const rate = Number(rateEl.value);
      const tenure = Number(tenureEl.value);
      const result = calculateEMI(principal, rate, tenure);
      const schedule = generateAmortizationSchedule(principal, rate, tenure, result.emi);
      const pPercent = ((principal / result.totalPayment) * 100).toFixed(1);
      const iPercent = ((result.totalInterest / result.totalPayment) * 100).toFixed(1);
      
      let html = `
        <html>
        <head>
          <title>Amortization Schedule PDF</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 1em; margin: 0;}
            h2 { color: #2d6cdf; margin-bottom: 0.5em;}
            .summary { 
              margin: 16px 0; 
              padding: 12px;
              background: #f5f7fa;
              border-radius: 8px;
            }
            .summary-text {
              font-size: 0.95rem;
              color: #333;
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin-top: 1em;
            }
            th, td { 
              border: 1px solid #e0e4ea; 
              padding: 8px; 
              text-align: right;
              font-size: 0.9rem;
            }
            th { 
              background: #f5f7fa; 
              color: #2d6cdf;
              font-weight: 600;
            }
            td:first-child, th:first-child { 
              text-align: center;
            }
            tbody tr:nth-child(even) {
              background: #fafbfc;
            }
          </style>
        </head>
        <body>
          <h2>Amortization Schedule</h2>
          <div class="summary">
            <div class="summary-text">
              <strong>Principal:</strong> ₹${fmt2(principal)} (${pPercent}%) | 
              <strong>Interest:</strong> ₹${fmt2(result.totalInterest)} (${iPercent}%)
            </div>
          </div>
          <table>
            <tr>
              <th>Month</th>
              <th>EMI</th>
              <th>Principal Paid</th>
              <th>Interest Paid</th>
              <th>Balance</th>
            </tr>
            ${schedule.map(row => `
              <tr>
                <td>${row.month}</td>
                <td>${fmt2(row.emi)}</td>
                <td>${fmt2(row.principalPaid)}</td>
                <td>${fmt2(row.interestPaid)}</td>
                <td>${fmt2(row.balance)}</td>
              </tr>
            `).join('')}
          </table>
        </body>
        </html>
      `;
      const win = window.open('', '_blank');
      win.document.write(html);
      win.document.close();
      win.print();
    });

    // Collapsible amortization table
    let collapseOpen = false;
    collapseHeader.addEventListener('click', function() {
      collapseOpen = !collapseOpen;
      amortCollapse.classList.toggle('expanded', collapseOpen);
      amortSection.style.display = collapseOpen ? 'block' : 'none';
    });
    // Helper text tooltips for mobile
    function setupHelperTooltip(iconId, tooltipId) {
      const icon = document.getElementById(iconId);
      const tooltip = document.getElementById(tooltipId);
      let show = false;
      icon.addEventListener('click', function(e) {
        show = !show;
        tooltip.style.display = show ? 'block' : 'none';
      });
      icon.addEventListener('blur', function() {
        show = false;
        tooltip.style.display = 'none';
      });
    }
    setupHelperTooltip('principalHelperIcon', 'principalHelperTooltip');
    setupHelperTooltip('rateHelperIcon', 'rateHelperTooltip');
    setupHelperTooltip('tenureHelperIcon', 'tenureHelperTooltip');

    // Initial setup
    setActiveTab('home');
    updateResults();
    updateAmortTable();

    // On page load, set tab from hash if present
    window.addEventListener('DOMContentLoaded', () => {
      const hash = location.hash.replace('#','');
      if (loanTypes[hash]) setActiveTab(hash, false);
    });
  </script>
</body>
</html>
